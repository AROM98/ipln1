#!/Library/Frameworks/Python.framework/Versions/3.9/bin/python3
"""
filtro para leitura de varios ficheiro passados em linha de comando

...
"""
import sys
from getopt import getopt
from re import *
import re
from pickle import *
import spacy 




# vai chamar-se interact e sera a função que usa o spacy para encontrar ralaçoes entre as personagens.
def procFam(f, i):
    pass



# vai dividir livro por capitulos e usar a funçao interact em cada um.
def procTexto(t):
    text2 = sub(r'\f', '', txt)
    text3 = sub(r'\n\n+', '\n', text2)
    text4 = sub(r'(\n[A-Z])\n', r'\n\1', text3)
    # texto limpo
    regex = r"(CHAPTER\ \w+)\s+([A-Z\ \'\,\.\-]+)\s+(.*?|\n)(?=CHAPTER\s\w+|Text copyright)"
    #capitulos = findall(r"(CHAPTER\ \w+)\s+([A-Z\ \'\,\.\-]+)\s+(.*?|\n)(?=CHAPTER\s\w+|Text copyright)", text4)
    matches = re.finditer(regex, text4, re.DOTALL)

    for matchNum, match in enumerate(matches, start=1):
    
        print('.....................................\n') 
        print(match.group(1)+'\n') # nº do capitulo
        print(match.group(2)+'\n') # nome do capitulo
        print(match.group(3)+'\n') # texto do capitulo
        print('.....................................\n')   


ops,args = getopt(sys.argv[1:],"a:o:")
ops = dict(ops)
for ficheiro in args:
    with open(ficheiro) as f :
        txt = f.read()
    #processar o texto
    procTexto(txt)


#  rever isto do pickle ---- Pickler.dump()

#diferentes opçoes
if '-a' in ops:
    pass
    #gTree(ops["-a"])


